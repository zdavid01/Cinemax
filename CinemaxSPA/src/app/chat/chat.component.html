@if(chatState$ | async; as chatState) {
<div class="h-full flex flex-col bg-gray-900">
  <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-3 flex-shrink-0">
    <h2 class="text-white text-sm font-semibold truncate">{{movieTitle}}</h2>
  </div>
  <div class="flex-1 p-3 overflow-y-auto bg-gray-800" #scrollContainer>
    <div class="space-y-2">
      @for(message of chatState.messages; track $index) {
      <div [ngClass]="{'flex justify-start': !message.isSent, 'flex justify-end': message.isSent}">
        <div class="flex items-start max-w-[85%] space-x-2"
          [ngClass]="{'flex-row-reverse space-x-reverse': message.isSent}">
          <div class="relative flex-shrink-0">
            <img [src]="message.avatar" alt="User avatar"
              class="w-7 h-7 rounded-full object-cover border-2 border-gray-700 shadow-md">
            <div class="absolute bottom-0 right-0 w-2 h-2 rounded-full bg-green-500 border border-gray-900"></div>
          </div>
          <div [ngClass]="{'bg-blue-600 text-white': message.isSent, 'bg-gray-700 text-white': !message.isSent}"
            class="rounded-lg p-2 shadow-md">
            <div class="flex items-center space-x-2">
              <span class="font-semibold text-xs">{{message.sender}}</span>
              <span class="text-[10px] opacity-70">{{message.timestamp | date:'shortTime'}}</span>
            </div>
            <p class="mt-1 text-xs leading-relaxed">{{message.content}}</p>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  <div class="p-3 border-t border-gray-700 bg-gray-900 flex-shrink-0">
    <form (ngSubmit)="sendMessage()" #messageForm="ngForm" class="flex space-x-2">
      <input type="text" [(ngModel)]="newMessage" name="message"
        class="flex-1 rounded-lg border border-gray-600 px-3 py-2 text-sm text-white bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
        placeholder="Type message..." aria-label="Message input">
      <button type="submit"
        class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg px-4 py-2 hover:shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0"
        [disabled]="!newMessage.trim()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path
            d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.429a1 1 0 001.17-1.409l-7-14z" />
        </svg>
      </button>
    </form>
  </div>
</div>
}